\documentclass[withoutpreface,bwprint]{cumcmthesis} %去掉封面与编号页，电子版提交的时候使用。

\usepackage[framemethod=TikZ]{mdframed}
\usepackage{url}   % 网页链接
\usepackage{subcaption} % 子标题
\usepackage{mathtools}

\bibliographystyle{plain}

\title{“FAST”主动反射面的形状调节}
\begin{document}

\maketitle
\begin{abstract}
本文研究我国具有自主知识产权的射电望远镜中国天眼---“FAST”的反射面板从基准态调整到工作态的这一过程，
并分析工作态时馈源舱接收到的有效信号与反射面的反射信号之比。

问题一要求在观测天体发射的电磁波竖直向下的情况下，并考虑反射面板调节因素的，确定理想抛物面。
我们通过数据拟合观测确定具体的基准球面方程。在 $z$ 轴负半轴一定范围内通过蒙特卡洛法枚举抛物面顶点
的坐标，并以口径筛选后剩余主索结点的总调节长度最小为原则，使用变步长法解得抛物面顶点的坐标为
$(0,0,-300.90527)$，从而得到抛物面方程为：$x^2+y^2=562.3456(z+300.9053)$

问题二要求观测天体坐标在 $\alpha =26.795^\circ，\beta =78.169^\circ$的情况下，确定理想抛物面方
程并给出主索结点的调节方案。
通过分析旋转基准球面和旋转抛物面的运算代价，我们最终选择旋转基准球面来固定抛物线开口仍沿 $z$ 轴，
对于旋转之后主索节点坐标的计算，我们选择使用Hamilton四元数和罗德里格旋转公式推导一个引理，用其结论
得到主索节点旋转后的坐标点。
这样理想抛物面的顶点始终在 $z$ 轴的负半轴上且抛物面以 $z$ 轴为对称轴。之后使用问题一的理想抛物面求
解过程，求解旋转后的理想抛物面顶点。再利用旋转的逆运算将顶点旋转回题目所给空间直角坐标系中即可求得
理想抛物面的顶点。同时，根据旋转后坐标系中主索节点工作态的坐标，可计算各个主索节点对应促动器的伸缩量。
根据主索节点的编号以及对应促动器的伸缩量可计算出题目所给坐标系中工作态主索节点的坐标。最终理想抛物面
的顶点坐标为 $(-49.39983133,-36.9490723,-294.4942374)$，完整的结果保存在了附录4.xlsx表格中。

问题三要求基于问题二的反射面调节方案，计算调节后馈源舱的接收比。我们首先需要筛选以出工作区内主索
节点为顶点的反射面板，将筛选结果记入表格work\_triangle-s.xlsx（表格已存入支撑材料）。对于其中一个
反射面板，我们选取三角形反射面板的三个顶点为标准计算法向量，通过反射原理与立体解析几何计算光束经过
工作区域内反射面板到达馈源舱有效区域所在平面的位置，由于反射面板面积远大于有效区域面积，我们计算馈
源舱中心是否在反射后的光束中来确定反射的电磁波是否被接收，经过对工作态300m口径内所有反射面板的计算，
我们得到 $1300$ 个反射面板中 $385$ 个面板反射的光束被有效接收，得到调节后馈源舱接收比：
$p1 = 29.62\%$，同理，我们对于整个基准反射球面的所有主索结点进行计算，得到未经调整的馈源舱接收比：
$p2 = 10.02\%$。经过对比，调整为工作态能将馈源舱的接收比大幅度提高（提高了 $195.6\%$）。

\keywords{蒙特卡洛法\quad 鬼哭狼嚎\quad 无人生还}
\end{abstract}

%目录  2019 明确不要目录，我觉得这个规定太好了
%\tableofcontents

%\newpage

\section{问题重述}
中国天眼——$500$米口径球面射电望远镜（Five-hundred-meter Aperture Spherical radio
Telescope，简称 FAST），是我国具有自主知识产权的目前世界上单口径最大、灵敏度最高的
射电望远镜。它的落成启用，对我国在科学前沿实现重大原创突破、加快创新驱动发展具有重
要意义。

FAST 由主动反射面、信号接收系统（馈源舱）以及相关的控制、测量和支承系统组成，其中
主动反射面系统是由主索网、反射面板、下拉索、促动器及支承结构等主要部件构成的一个可
调节球面。主索网由柔性主索按照短程线三角网格方式构成，用于支承反射面板（含背架结
构），每个三角网格上安装一块反射面板，整个索网固定在周边支承结构上。每个主索节点连
接一根下拉索，下拉索下端与固定在地表的促动器连接，实现对主索网的形态控制。反射面板
间有一定缝隙，能够确保反射面板在变位时不会被挤压、拉扯而变形。

主动反射面可分为两个状态：基准态和工作态。基准态时反射面为半径约 $300$ 米、口径为
$500$ 米的球面（基准球面）；工作态时反射面的形状被调节为一个 $300$ 米口径的近似旋转抛物
面（工作抛物面）。馈源舱接收平面的中心只能在与基准球面同心的一个球面（焦面）上移动，两同
心球面的半径差为 F=$0.466$R（其中 R 为基准球面半径，称 F/R 为焦径比）。馈源舱接收信号
的有效区域为直径 $1$ 米的中心圆盘。当 FAST 观测某个方向的天体目标时，馈源舱接收平面的中
心被移动到天体目标与基准球面的球心连成的直线与焦面的交点处，调节基准球面上的部分反射面板
形成以天体目标与基准球面的球心连成的直线为对称轴、以馈源舱接收信号为焦点的近似旋转
抛物面，从而将来自目标天体的平行电磁波反射汇聚到馈源舱的有效区域。

将反射面调节为工作抛物面是主动反射面技术的关键，该过程通过下拉索与促动器配合来
完成。下拉索长度固定。促动器沿基准球面径向安装，其底端固定在地面，顶端可沿基准球面
径向伸缩来完成下拉索的调节，从而调节反射面板的位置，最终形成工作抛物面。

本赛题要解决的问题是：在反射面板调节约束下，确定一个理想抛物面，然后通过调节促
动器的径向伸缩量，将反射面调节为工作抛物面，使得该工作抛物面尽量贴近理想抛物面，以
获得天体电磁波经反射面反射后的最佳接收效果。

请你们团队根据附录中的要求及相关参数建立模型解决以下问题：
\begin{enumerate}
    \item 当待观测天体 $𝑆$ 位于基准球面正上方，即 $\alpha = 0°$, $\beta = 90°$ 时，结合考虑反
          射面板调节因素，确定理想抛物面。
    \item 当待观测天体 $𝑆$ 位于 $\alpha = 36.795°$, $\beta = 78.169°$ 时，确定理想抛物面。
          建立反射面板调节模型，调节相关促动器的伸缩量，使反射面尽量贴近该理想抛物面。将理想抛物面
          的顶点坐标，以及调节后反射面 $300$ 米口径内的主索节点编号、位置坐标、各促动器的伸缩量等
          结果按照规定的格式（见附件 $4$）保存在“result.xlsx”文件中。
    \item 基于第 $2$ 问的反射面调节方案，计算调节后馈源舱的接收比，即馈源舱有效区域接收到
          的反射信号与 $300$ 米口径内反射面的反射信号之比，并与基准反射球面的接收比作比较。
\end{enumerate}

\section{问题分析}
\subsection{问题一分析}
在 $\alpha = 0^\circ , \beta = 90^\circ$ 的情况中，天体位于“FAST”射电望远镜的正上方。所以可以使用
本题所给出的三维空间模型进行求解。考虑到反射调节因素，本文期望能尽可能少的移动主索节点来使反射面从球面
变为抛物面。

本文首先在比 $300m$ 口径稍大的范围内筛选一些主索节点。通过遍历抛物面顶点的坐标，再调节各个
主索节点的位置，使它们尽量位于抛物面上。然后以 $300m$ 口径的范围为条件去筛选修正过位置的主索节点。筛选
出符合条件的主索节点后计算所有主索节点移动距离之和。先通过大步长粗略搜索找到较小值的范围，然后通过小步
长来精确搜索得出精确度较高的模型的解。将所有主索节点移动距离之和最小时的抛物面顶点坐标作为理想抛物面顶
点。
\subsection{问题二分析}
在 $\alpha = 36.795^\circ , \beta = 78.169^\circ$ 的情况中，直接使用本题所给出的三维空间难以计算
出抛物面的顶点。本文通过旋转坐标系来建立一个抛物面开口方向与 $z$ 轴正方向相同的空间直角坐标系，以
此简化计算。

由于 $\alpha = 36.795^\circ , \beta = 78.169^\circ$，所以坐标系需要进行两次绕轴旋转。
本文使用Hamilton四元数，将三维空间中的两次旋转等效为一次旋转。再计算出一次旋转的旋转轴和旋转角度，
之后利用罗德里格旋转公式将附件1中的基准球面上主索节点的坐标转换到新的坐标系中。然后利用问题一中的方法
找出抛物面顶点的坐标。再通过逆用之前的旋转公式将求得的抛物面顶点坐标转换为题目所给坐标系中的坐标。最后
利用由两点间距离公式计算出的新坐标系中工作态主索节点坐标与基准球面主索节点坐标间距离来求得各个主索节点
的促动器顶端的径向伸缩量，再通过伸缩量在原坐标系中得到原坐标系工作态主索节点的位置。
\subsection{问题三分析}
\section{模型建立}
\subsection{符号说明}
\begin{center}
    \begin{tabular}{cc}
        \hline
        \makebox[0.3\textwidth][c]{符号} & \makebox[0.4\textwidth][c]{意义}               \\
        \hline
        R                                & 基准态时反射面半径（m）                         \\
        \hline
    \end{tabular}
\end{center}
\subsection{问题一}
\subsubsection{模型的建立}
因为 $\alpha = 0^\circ ,\beta = 90^\circ$ 且题目所给的坐标系以基准球面的球心为原点，
所以本文直接使用题目所给的空间直角坐标系。工作态所需的口径为 $300m$，基准球面半径约为 $300m$，
本文通过附件1中所给出的数据并利用两点间距离公式获得较为精确的半径为 $300.4m$。由于所需的
口径为 $300m$，然而在由基准球面调节为工作态时各主索节点与 $z$ 轴的距离会发生改变，而 $z$ 轴同时
是抛物面的中心对称轴，也是工作态的中轴，所以需要在 $300m$ 口径的范围上增加一定长度 $\xi m$，
在调整主索节点位置之后，再利用准确的 $300m$ 口径去筛选符合条件的主索节点。

工作抛物面顶点处的法线与基准球面口径为 $300m$ 处的边界点和球心的连线成大约 $30^\circ$ 的
角，如图 \ref{fig:range} 中左图所示。在基准状态下，促动器的径向伸缩范围为$-0.6\sim +0.6m$，则在水
平方向上的伸缩范围为 $-0.3\sim +0.3m$（如图 \ref{fig:range} 中右图所示），所以 $\xi = 0.3$。
所以在坐标范围 $x^2 + y^2 \leqslant (150 + \xi)^2$ 中，筛选出应当调节的主索节点。
\begin{figure}[!h]
    \centering
    \begin{minipage}[c]{0.48\textwidth}
        \centering
        \includegraphics[height=0.2\textheight]{angle1.pdf}
    \end{minipage}
    \begin{minipage}[c]{0.48\textwidth}
        \centering
        \includegraphics[height=0.2\textheight]{angle2.pdf}
    \end{minipage}
    \caption{}
    \label{fig:range}
\end{figure}

对于理想抛物面顶点的位置，本文采用蒙特卡洛法，对抛物面顶点进行打靶，搜索使由基准球面到工作态所有
筛选出的主索节点移动距离之和最小的抛物面顶点位置。

对于打靶范围的选择，由于促动器顶端径向伸缩量的范围是 $-0.6\sim +0.6m$。当抛物面顶点位置距离基准
球面过远时，绝大多数促动器所需调节的距离可能超过 $-0.6\sim +0.6m$。随着顶点由基准球面圆心向下移
动，调节距离之和呈现先减小后增大的趋势。在贴近基准球面处其值较小，故本文选择的范围为$\left[R-1.2,
R+1.2\right]m$。

若抛物面的顶点为 $(0,0,-a)$，可以通过焦点 $P$ 和顶点，进而确定抛物面的方程，记 $p$ 为焦距，
$p = a-R \times 0.534$，抛物面的公式为
\begin{equation}
    \label{eq:paraboloid}
    x^2 + y^2 = 4p(z + a)
\end{equation}

由于促动器伸缩沿基准球面径向，所以主索节点的位置移动均在一条过基准球面球心的直线上，可以通过球心
坐标 $(x_1,y_1,z_1)$ 和主索节点坐标 $(x_2,y_2,z_2)$ 计算得这个直线的方程为
\begin{equation}
    \label{eq:line}
    \frac{\displaystyle x - x_1}{\displaystyle x_2 - x_1} = \frac{\displaystyle y - y_1}
    {\displaystyle y_2 - y_1} = \frac{\displaystyle z - z_1}{\displaystyle z_2 - z_1}
\end{equation}

联立方程 \eqref{eq:paraboloid} 与 \eqref{eq:line} 解得忽视促动器调节因素的情况下最理想的主索
节点坐标为
\[
\begin{dcases}
    \smallskip
    x = \frac{(2\times x_2\times (p\times z_2 + \sqrt{p\times (a\times x_2^2 + a\times
    y_2^2 + p\times z_2^2)}))}{(x_2^2 + y_2^2)}  \\
    \smallskip
    y = \frac{(2\times x_2\times (p\times z_2 + \sqrt{p\times (a\times x_2^2 + a\times
    y_2^2 + p\times z_2^2)}))}{(x_2^2 + y_2^2)(x_2 \times y_2)}  \\
    z = \frac{(2\times x_2\times (p\times z_2 + \sqrt{p\times (a\times x_2^2 + a\times
    y_2^2 + p\times z_2^2)}))}{(x_2^2 + y_2^2)(x_2 \times z_2)}  \\
\end{dcases}
\]

在此范围中先以大步长 $0.1m$ 对抛物面顶点坐标进行枚举。并根据每次的枚举来调节相关主索节点的位置，
使其位于或尽量贴近理想抛物面。在调节完位置后，其中的一些主索节点很有可能已经超出了口径为 $300m$
的工作抛物面，需要对其再进行一次筛选，将那些超出工作抛物面范围的主索节点去除。

选取坐标满足$x^2 + y^2 \leqslant 150^2$ 的主索节点来进行下一步计算。将选取出的主索节点与球心
相连获得直线，由直线与理想抛物面相交获得该点对应于理想抛物面上的点，也就是主索节点由基准球面移动
到理想抛物面上的位置。由两点位置计算主索节点由基准球面移动到理想抛物面上的距离，并将选取出的点的
移动距离求和。将移动距离大于 $0.6m$ 的数据限制为 $0.6m$，最终根据总移动距离最小选取理想抛物面。

由大步长将 $a$ 的数据范围确定在 $300.9$ 附近之后，由于题目的精度要求，使用小步长 $0.00001m$ 在
$299m \sim 301m$的范围内进行精度更高的数据搜索。
\subsubsection{模型的解}
通过最终的小步长搜索得出最优值 $a = 300.9053$。可算出 $p = 140.5864$，所以得到的理想抛物面的方
程为
\[
    x^2 + y^2 = 562.3456(z + 300.9053)
\]
\subsection{问题二}
\subsubsection{模型的建立及求解}
由于问题 $2$ 天体角度的变化，导致抛物面的开口方向不再沿 $z$ 轴正方向，又由于抛物面绕轴旋转之后
公式过于复杂，本文采用逆向旋转整个基准球面的方法来使抛物面开口始终沿 $z$ 轴正方向。

如果旋转抛物面，需要先绕 $z$ 轴(方向向量 $(0,0,1)$)沿右手方向旋转 $\alpha$ 角，此时的旋转矩
阵设为 $R$,再绕 $y$ 轴旋转后的方向向量 $(0,1,0)\cdot R$ 沿右手方向旋转 $90^\circ-\beta$
角。

所以逆向旋转基准球面的方法应为先绕 $(0,1,0)\cdot R$ 沿右手方向旋转 $\beta-90^\circ$ 角，
再绕方向向量 $(0,0,1)$ 沿右手方向旋转 $-\alpha$ 角。

对于两次旋转的叠加，本文使用Hamilton四元数和罗德里格旋转公式相结合的方法，证明引理：
\begin{quote}
    第一次绕 $\overrightarrow{n_1}$ 旋转 $\theta _1$ 角，第二次绕 $\overrightarrow{n_2}$
    旋转 $\theta _2$ 角，那么相当于绕 $\overrightarrow{n}$ 旋转 $\theta$ 角。
    \[
        \begin{split}
            &\cos(\frac{\theta}{2}) = \cos(\frac{\theta _1}{2})
            \cos(\frac{\theta _2}{2}) - (\overrightarrow{n_1} \cdot 
            \overrightarrow{n_2})\sin(\frac{\theta _1}{2})
            \sin(\frac{\theta _2}{2}) \\
            &\overrightarrow{n} = \frac{\displaystyle \overrightarrow{n_1}
            \cos(\frac{\theta _2}{2})\sin(\frac{\theta _1}{2}) + 
            \overrightarrow{n_2}\cos(\frac{\theta _1}{2})
            \sin(\frac{\theta _2}{2}) + \overrightarrow{n_1} \times 
            \overrightarrow{n_2}\sin(\frac{\theta _1}{2})
            \sin(\frac{\theta _2}{2})}
            {\displaystyle \sin(\frac{\theta}{2})} 
        \end{split}
    \]
\end{quote}

\noindent\textbf{证明：}

Hamilton四元数为高阶复数，形如：$q=a+bi+cj+dk$ \par
$i,j,k$ 为虚数，$i^2=j^2=k^2=-1;$ \par
$i \times j=k,$ \par
$i \times k=-j,$ \par
$j \times k=i,$ \par
$j \times i=-k,$ \par
$k \times i=j,$ \par
$k \times j=-i;$ \par
$q=a+bi+cj+dk$ 的共轭四元数为：$q^*=a-bi-cj-dk$ \par
满足：\par
$qq^*=a^2-(bi+cj+dk)^2=a^2+b^2+c^2+d^2-bck+bck-cdi+cdi-bdj+bdj$ \par
\quad\ \ \,$=a^2+b^2+c^2+d^2=|q|^2$ \par
$|q|$ 为 $q$ 的模长。\par
定义 $q$ 的逆为 $q^{-1}=\frac{\displaystyle q^*}{\displaystyle |q|^2}$ \par
可以推出 $q^{-1}q=1$ \par
下面我们先证明：空间中的任意向量 $( x ,y ,z )$，在绕单位向量 $(n_x,n_y,n_z)$旋转 $\theta $
角后（右手方向为正方向），其新的坐标位置由四元数 $r$ 的 $i , j , k$ 分量给出：\par
$r=qpq^{-1},p=xi+yj+zk,$ \par
$q = \cos(\frac{\theta }{2}) + \sin(\frac{\theta }{2})(n_xi + 
    n_yj + n_zk)$ \par
由于 $q$ 的模长为 $1$, 可知 $q^{-1}=q^*$ \par
(为便于计算我们直接将向量的基视为复数) \par
$r = qpq^{-1} = (\cos(\frac{\theta}{2}) + 
\sin(\frac{\theta}{2})\overrightarrow{n})\overrightarrow{p} 
(\cos(\frac{\theta}{2}) - \sin(\frac{\theta}{2})
\overrightarrow{n})$ \par
其中 $pq^{-1} = \overrightarrow{p} (\cos(\frac{\theta}{2}) - 
\sin(\frac{\theta}{2})\overrightarrow{n}) = 
\sin(\frac{\theta}{2})\overrightarrow{n} \cdot \overrightarrow{p} -
\sin(\frac{\theta}{2})\overrightarrow{p} \times \overrightarrow{n} +
\overrightarrow{p} \cos(\frac{\theta}{2})$
\[
    %\begin{array}{l}
    \begin{split}
        r &= qpq^{-1} \\ &= (\cos(\frac{\theta}{2}) - 
        \sin(\frac{\theta}{2})\overrightarrow{n})
        (\sin(\frac{\theta}{2})\overrightarrow{n} \cdot \overrightarrow{p} -
        \sin(\frac{\theta}{2})\overrightarrow{p} \times \overrightarrow{n} +
        \overrightarrow{p}\cos(\frac{\theta}{2})) \\ &= \sin(\frac{\theta}{2})
        \cos(\frac{\theta}{2})\overrightarrow{n} \cdot \overrightarrow{p} -
        (\sin(\frac{\theta}{2})\overrightarrow{n}) \cdot
        [-\sin(\frac{\theta}{2})\overrightarrow{p} \times \overrightarrow{n} +
        \overrightarrow{p}\cos(\frac{\theta}{2})] \\ &\quad + 
        [\sin(\frac{\theta}{2})\overrightarrow{n} \times 
        (-\sin(\frac{\theta}{2})\overrightarrow{p} \times \overrightarrow{n} +
        \cos(\frac{\theta}{2})\overrightarrow{p})] + \sin ^2
        (\frac{\theta}{2})(\overrightarrow{n} \cdot \overrightarrow{p})
        \overrightarrow{n} \\ &\quad + \cos ^2(\frac{\theta}{2})\overrightarrow{p} -
        \cos(\frac{\theta}{2})\sin(\frac{\theta}{2})\overrightarrow{p} \times 
        \overrightarrow{n} \\ &= -\sin^2(\frac{\theta}{2})\overrightarrow{n} \times
        (\overrightarrow{p} \times \overrightarrow{n}) +
        \sin^2(\overrightarrow{n} \cdot \overrightarrow{p})\overrightarrow{n} +
        \cos^2(\frac{\theta}{2})\overrightarrow{p} \\ &\quad - 2\cos(\frac{\theta}{2})
        \sin(\frac{\theta}{2})\overrightarrow{p} \times \overrightarrow{n} 
    \end{split}
    %\end{array}
\]
\phantom{哈哈}代入，得：\par
原式 $= \cos(\theta)\overrightarrow{p} - \sin(\theta)\overrightarrow{p} \times
\overrightarrow{n} + 2\sin^2(\frac{\theta}{2})(\overrightarrow{n} \cdot 
\overrightarrow{p})\overrightarrow{n} = \cos(\theta)\overrightarrow{p} -
\sin(\theta)\overrightarrow{p} \times \overrightarrow{n} +
(1 - \cos(\theta ))(\overrightarrow{n} \cdot \overrightarrow{p})
\overrightarrow{n} $
形式与罗德里格旋转公式相同，所以得证。 \par
我们再证明引理 \par
我们知道两次旋转之后的坐标为 $pqrp^{-1}q^{-1}$ \par
我们记第一次旋转绕向量 $n_1$ 旋转了 $\theta _1$ 角，第二次旋转绕向量 $n_2$ 旋转了 $\theta _2$角，
则第一次旋转得到的坐标为 $prp^{-1}$，第二次旋转得到的坐标为 $qprp^{-1}q^{-1}$，其中
\[
    \begin{split}
        p = \cos(\frac{\theta _1}{2}) + \sin(\frac{\theta _1}{2})n_{1x}i +
        \sin(\frac{\theta _1}{2})n_{1y}j + \sin(\frac{\theta _1}{2})n_{1z}k, \\
        q = \cos(\frac{\theta _2}{2}) + \sin(\frac{\theta _2}{2})n_{2x}i +
        \sin(\frac{\theta _2}{2})n_{2y}j + \sin(\frac{\theta _2}{2})n_{2z}k
    \end{split}
\]

易知，$qp$ 和 $p^{-1}q^{-1}$ 共轭，要证明：
\[
    qp = \cos(\theta) + \sin(\theta)n_xi + \sin(\theta)n_yj +
    \sin(\theta)n_zk
\]

其中 $\theta$ 和 $\overrightarrow{n}$ 待定。
\[
    \begin{split}
        qp &= (\cos(\frac{\theta _2}{2}) + \sin(\frac{\theta _2}{2})n_{2x}i
        + \sin(\frac{\theta _2}{2})n_{2y}j + \sin(\frac{\theta _2}{2})n_{2z}k)
        (\cos(\frac{\theta _1}{2}) + \sin(\frac{\theta _1}{2})n_{1x}i \\ &\quad +
        \sin(\frac{\theta _1}{2})n_{1y}j + \sin(\frac{\theta _1}{2})n_{1z}k) \\
        &= \cos(\frac{\theta _1}{2})\cos(\frac{\theta _2}{2}) - 
        \sin(\frac{\theta _1}{2})\sin(\frac{\theta _2}{2})\overrightarrow{n_1} 
        \cdot \overrightarrow{n_2} + \cos(\frac{\theta _2}{2})
        \sin(\frac{\theta _1}{2})\overrightarrow{n_1} \\&\quad + 
        \cos(\frac{\theta _1}{2})\sin(\frac{\theta _2}{2})\overrightarrow{n_2} +
        \sin(\frac{\theta _1}{2})\sin(\frac{\theta _2}{2})(\overrightarrow{n_1}
        \times n_2)
    \end{split}
\]

我们证明，上式的模为 $1$ \par
实部的平方为：
\begin{align*}
    \cos ^2(\frac{\theta _1}{2})\cos ^2&(\frac{\theta _2}{2}) +
    \sin ^2(\frac{\theta _1}{2})\sin ^2(\frac{\theta _2}{2})
    (\overrightarrow{n_1} \cdot \overrightarrow{n_2})^2 \\ &-
    2\cos(\frac{\theta _1}{2})\cos(\frac{\theta _2}{2})
    \sin(\frac{\theta _1}{2})\sin(\frac{\theta _2}{2})
    \overrightarrow{n_1} \cdot \overrightarrow{n_2} 
\end{align*}

虚部的平方为：
\begin{align*}
    \cos ^2(\frac{\theta _2}{2})&\sin ^2(\frac{\theta _1}{2}) +
    \cos ^2(\frac{\theta _1}{2})\sin ^2(\frac{\theta _2}{2}) \\ & +
    \sin ^2(\frac{\theta _1}{2})\sin ^2(\frac{\theta _2}{2})
    (\overrightarrow{n_1} \times \overrightarrow{n_2})^2 \\ &\quad +
    2\cos(\frac{\theta _1}{2})\cos(\frac{\theta _2}{2})
    \sin(\frac{\theta _1}{2})\sin(\frac{\theta _2}{2})
    \overrightarrow{n_1} \cdot \overrightarrow{n_2} 
\end{align*}

由于 $(\overrightarrow{n_1} \times \overrightarrow{n_2})^2 + (\overrightarrow{n_1} 
\times \overrightarrow{n_1})^2 = 1$，易知，实部和虚部平方之和为 $1$。

由此可得：旋转角为
\[
    \begin{split}
        &\cos(\frac{\theta}{2}) = \cos(\frac{\theta _1}{2})
        \cos(\frac{\theta _2}{2}) - (\overrightarrow{n_1} \cdot 
        \overrightarrow{n_2})\sin(\frac{\theta _1}{2})
        \sin(\frac{\theta _2}{2}) \\
        &\overrightarrow{n} = \frac{\displaystyle \overrightarrow{n_1}
        \cos(\frac{\theta _2}{2})\sin(\frac{\theta _1}{2}) + 
        \overrightarrow{n_2}\cos(\frac{\theta _1}{2})
        \sin(\frac{\theta _2}{2}) + \overrightarrow{n_1} \times 
        \overrightarrow{n_2}\sin(\frac{\theta _1}{2})
        \sin(\frac{\theta _2}{2})}
        {\displaystyle \sin(\frac{\theta}{2})} 
    \end{split}
\]\par
\textbf{证毕 $\Box$}

\medskip
\medskip
\medskip
我们将题目附件 $1$ 中数据引入，使用上文中证明的旋转公式，将基准球面各个点的坐标旋转到抛物
面的对应位置，并将各点坐标保存到“旋转球面.xls”文件中。之后，我们根据工作抛物面的范围，选
取出调整后可满足位于工作抛物面之内的点。这里我们采用条件为：
\[
    x^2+y^2<(150+0.3)^2
\]
此处选用 $150+0.3$ 的原因同第一问。

之后，在旋转后的坐标系中，我们同第一问一样，使用蒙特卡罗方法枚举抛物面顶点的坐标，并利用变
步长法提高精度。此处对于顶点坐标的选取原则不变，仍为使得最终所有顶点调节的距离之和最小，对
于调节范围之外的点，计其调节距离为 $0.6m$。求出最优的顶点后，可以获得对应的抛物面方程。

此时，我们有条件来求解每个主索结点在抛物面上对应的位置。同第一问，连接主索结点 $(x_1,y_1,z_1)$
与球心 $(x_c,y_c,z_c)$ 作出直线:
\[
    \frac{x-x_c}{x_1-x_c}=\frac{y-y_c}{y_1-y_c}=\frac{z-z_c}{z_1-z_c}
\]
直线与抛物面交点即为主索结点在抛物面上对应的位置。
根据以上模型，在旋转后的坐标系中，对于每个主索结点 $(x_1,y_1,z_1)$，得到其在抛物面上对应的新
位置 $(x_2,y_2,z_2)$ 后，我们可以求出该点移动距离:
\[
    d = \sqrt{(x_2-x_1)^2+(y_2-y_1)^2+(z_2-z_1)^2}
\]

同时，根据主索结点新旧位置的z坐标高低，我们可以判断促动器伸缩：如果新位置的 $z$ 坐标更大，则促
动器伸缩状态为“伸”（计伸缩量 $d$ 为正）；否则促动器伸缩状态为“缩”（计伸缩量 $d$ 为负）。

统计完每个主索结点的伸缩量后，我们回到原坐标系，根据基准球径向上各个点的伸缩量计算主索结点移动后
的位置坐标。设主索结点在基准球面上的原始坐标为 $(x0, y0, z0)$, 该节点对应促动器的伸缩量为 $d$，
主索结点对应抛物面上的新点坐标为 $(x, y,z)$,计算公式如下：
\[
    \begin{dcases}
        \smallskip
        x = x_0 - \frac{(d*x_0)}{\sqrt{x_0^2+y_0^2+z_0^2}}; \\
        \smallskip
        y = y_0 - \frac{(d*y_0)}{\sqrt{x_0^2+y_0^2+z_0^2}}; \\
        z = z_0 - \frac{(d*z_0)}{\sqrt{x_0^2+y_0^2+z_0^2}};
    \end{dcases}
\]

之后将得到的解存入目录的附录中。
\subsection{问题三}
\subsubsection{模型的建立}
\subsubsection{模型的解}
\nocite{宋叶志2019}
\bibliography{references}
\begin{appendices}
\section{第一问MATLAB代码一(大步长)}
\begin{lstlisting}[language=matlab]
clear all, clc;

%读入数据
data = xlsread("附件1.csv", 1, 'B2:D2227');%(n*3的矩阵)
data2 = [];
cnt2 = 0;
for i = 1:2226
    x = data(i,1);
    y = data(i,2);
    z = data(i,3);
    if x^2+y^2 <= 150.3^2
        data2 = [data2; i, x, y, z];
        cnt2 = cnt2 + 1;
    end
end
anss = inf;
finala = 0;
for a = 300.4-1.2:0.1:300.4+1.2
    s = 0;
    p = a-300.4*0.534;
    for i = 1:cnt2
        num = data2(i,1);
        x2 = data2(i,2);
        y2 = data2(i,3);
        z2 = data2(i,4);
        ansx1 = (2*x2*(p*z2 + sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2); 
        ansy1 = ansx1 / x2 * y2;
        ansz1 = ansx1 / x2 * z2;
        ansx2 = (2*x2*(p*z2 - sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2);
        ansy2 = ansx2 / x2 * y2;
        ansz2 = ansx2 / x2 * z2;
        if ansz2 < ansz1
            ansx = ansx2;
            ansy = ansy2;
            ansz = ansz2;
        else
            ansx = ansx1;
            ansy = ansy1;
            ansz = ansz1;
        end
        if ansx^2 + ansy^2 <= 150^2
            s = s + sqrt((ansx - x2)^2 + (ansy - y2)^2 + (ansz - z2)^2);
        end
    end
    if anss > s
        anss = s;
        finala = a;
    end
end
finala

\end{lstlisting}
\section{第一问MATLAB代码二(小步长)}
\begin{lstlisting}[language=matlab]
clear all, clc;

%读入数据
data = xlsread("附件1.csv", 1, 'B2:D2227');%(n*3的矩阵)
data2 = [];
cnt2 = 0;
for i = 1:2226
    x = data(i,1);
    y = data(i,2);
    z = data(i,3);
    if x^2+y^2 <= 150.3^2
        data2 = [data2; i, x, y, z];
        cnt2 = cnt2 + 1;
    end
end
anss = inf;
finala = 0;
for a = 299:0.00001:301
    s = 0;
    p = a-300.4*0.534;
    for i = 1:cnt2
        num = data2(i,1);
        x2 = data2(i,2);
        y2 = data2(i,3);
        z2 = data2(i,4);
        ansx1 = (2*x2*(p*z2 + sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2); 
        ansy1 = ansx1 / x2 * y2;
        ansz1 = ansx1 / x2 * z2;
        ansx2 = (2*x2*(p*z2 - sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2);
        ansy2 = ansx2 / x2 * y2;
        ansz2 = ansx2 / x2 * z2;
        if ansz2 < ansz1
            ansx = ansx2;
            ansy = ansy2;
            ansz = ansz2;
        else
            ansx = ansx1;
            ansy = ansy1;
            ansz = ansz1;
        end
        if ansx^2 + ansy^2 <= 150^2
            tmps = sqrt((ansx - x2)^2 + (ansy - y2)^2 + (ansz - z2)^2);
            if tmps > 0.6
                tmps = 0.6;
            end
            s = s + tmps;
        end
    end
    if anss > s
        anss = s;
        finala = a;
    end
end
finala

\end{lstlisting}
\section{第二问MATLAB代码一(大步长)}
\begin{lstlisting}[language=matlab]
clear all, clc;

%读入数据
R = 300.4;
data = xlsread("附件1.csv", 1, 'B2:D2227');%(n*3的矩阵)
[n1,names,n2] = xlsread("附件1.csv", 1, 'A2:A2227');
%names(1)
%names是现在的名称
%旋转球面上的点
n2 = [0 0 1];   n1 = [0 1 0];   
alpha = -36.795;     beta = 78.169;
n1 = n1 * [cosd(alpha), -sind(alpha),0;sind(alpha),cosd(alpha),0;0,0,1]
th2 = alpha;    th1 = beta-90;

a1 = n1(1,1);   b1 = n1(1,2);   c1 = n1(1,3);
a2 = n2(1,1);   b2 = n2(1,2);   c2 = n2(1,3);
n12 = [b1*c2-b2*c1, a2*c1-a1*c2, a1*b2-a2*b1];

th = 2 * acosd(cosd(th1/2)*cosd(th2/2)-sum(n1.*n2)*sind(th1/2)*sind(th2/2));
n = (n1*cosd(th2/2)*sind(th1/2)+n2*cosd(th1/2)*sind(th2/2)+
    n12*sind(th1/2)*sind(th2/2))/sind(th/2);
a1 = n(1,1);    b1 = n(1,2);    c1=n(1,3);

%求data2也就是旋转后的球面点坐标
data2 = [];
for i = 1:2226
    a2 = data(i,1);
    b2 = data(i,2);
    c2 = data(i,3);
    v = [a2 b2 c2];
    vv = [b1*c2-b2*c1, a2*c1-a1*c2, a1*b2-a2*b1];
    v1 = v*cosd(th) + vv*sind(th) + n*sum(n.*v)*(1-cosd(th));
    data2 = [data2; i, v1];
end
xlswrite("旋转球面.xls", data2);

%取出符合要求的点（然后才可以连线），存入到data3(是结构体数组)
cnt3 = 0;
for i = 1:2226
    name = names(i);
    x = data2(i,2);
    y = data2(i,3);
    z = data2(i,4);
    if(x^2+y^2<(150+0.3)^2)
        cnt3 = cnt3 + 1;
        data3(cnt3).x = x;
        data3(cnt3).y = y;
        data3(cnt3).z = z;
        data3(cnt3).num = i;
        data3(cnt3).name = name;
    end
end
cnt3
%根据选中的点们，选出a的大小
anss = inf;
finala = 0;
for a = 280:0.1:320
   s = 0;
   p = a-300.4*0.534;
    for i = 1:cnt3
       num = data3(i).num;
        x2 = data3(i).x;
        y2 = data3(i).y;
        z2 = data3(i).z;
        ansx1 = (2*x2*(p*z2 + sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2); 
        ansy1 = ansx1 / x2 * y2;
        ansz1 = ansx1 / x2 * z2;
        ansx2 = (2*x2*(p*z2 - sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2);
        ansy2 = ansx2 / x2 * y2;
        ansz2 = ansx2 / x2 * z2;
        if ansz2 < ansz1
            ansx = ansx2;
            ansy = ansy2;
            ansz = ansz2;
        else
            ansx = ansx1;
            ansy = ansy1;
            ansz = ansz1;
        end
        if ansx^2 + ansy^2 <= 150^2
            tmps = sqrt((ansx - x2)^2 + (ansy - y2)^2 + (ansz - z2)^2);
            if tmps > 0.6
                tmps = 0.6;
            end
            s = s + tmps;
        end
    end
    if anss > s
        anss = s;
        finala = a;
    end
end
finala
%对于旋转后的球面，连接基准球面上的点和球心，取连线与抛物面的交点即为最终应该调整到的点
%并重新存入data4
a = finala;
p = a - R*0.534;
for i = 1:cnt3
    x2 = data3(i).x;
    y2 = data3(i).y;
    z2 = data3(i).z;
    ansx1 = (2*x2*(p*z2 + sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2); 
    ansy1 = ansx1 / x2 * y2;
	ansz1 = ansx1 / x2 * z2;
    ansx2 = (2*x2*(p*z2 - sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2);
    ansy2 = ansx2 / x2 * y2;
    ansz2 = ansx2 / x2 * z2;
    if ansz2 < ansz1
        ansx = ansx2;
        ansy = ansy2;
        ansz = ansz2;
    else
        ansx = ansx1;
        ansy = ansy1;
        ansz = ansz1;
    end
    data4(i).x = ansx;
    data4(i).y = ansy;
    data4(i).z = ansz;
    data4(i).name = data3(i).name;
end
for i = 1 : cnt3
    x0 = data3(i).x;
    y0 = data3(i).y;
    z0 = data3(i).z;
    x1 = data4(i).x;
    y1 = data4(i).y;
    z1 = data4(i).z;
    
    data4(i).d = sqrt((x0-x1)^2+(y0-y1)^2+(z0-z1)^2);
    if data4(i).d > 0.6
        data4(i).d = 0.6;
    end
    if z1 > z0      %如果新节点更高的话就表示往上推了
        data4(i).d = data4(i).d;
    else            %否则表示往下拉了
        data4(i).d = -data4(i).d;
    end
    %将伸缩量数据存入表格
    ID = data4(i).name;
    delta = data4(i).d;
    ii = num2str(i);
    str1=strcat('A',ii);
    str1=[str1,':',str1];
    str2=strcat('B',ii);
    str2=[str2,':',str2];
    xlswrite('Output.xlsx',ID,1,str1);
    xlswrite('Output.xlsx',delta,1,str2);
    d = abs(data4(i).d);
    id = data3(i).num;
    x0 = data(id,1);
    y0 = data(id,2);
    z0 = data(id,3);
    data5(i).name = data3(i).name;
    data5(i).x = x0 - (d*x0)/sqrt(x0^2+y0^2+z0^2);
    data5(i).y = y0 - (d*y0)/sqrt(x0^2+y0^2+z0^2);
    data5(i).z = z0 - (d*z0)/sqrt(x0^2+y0^2+z0^2);
    %将坐标数据存入表格
    name = data5(i).name;
    xx = data5(i).x;
    yy = data5(i).y;
    zz = data5(i).z;
    ii = num2str(i);
    str1 = strcat('A',ii);
    str2 = strcat('B',ii);
    str3 = strcat('C',ii);
    str4 = strcat('D',ii);
    str1=[str1,':',str1];
    str2=[str2,':',str2];
    str3=[str3,':',str3];
    str4=[str4,':',str4];
    xlswrite('PointLocations2.xlsx',name,1,str1);
    xlswrite('PointLocations2.xlsx',xx,1,str2);
    xlswrite('PointLocations2.xlsx',yy,1,str3);
    xlswrite('PointLocations2.xlsx',zz,1,str4);
end

\end{lstlisting}
\section{第二问MATLAB代码二(小步长)}
\begin{lstlisting}[language=matlab]
clear all, clc;

%读入数据
R = 300.4;
data = xlsread("附件1.csv", 1, 'B2:D2227');%(n*3的矩阵)
[n1,names,n2] = xlsread("附件1.csv", 1, 'A2:A2227');
%names(1)
%names是现在的名称
%旋转球面上的点
n2 = [0 0 1];   n1 = [0 1 0];   
alpha = -36.795;     beta = 78.169;
n1 = n1 * [cosd(alpha), -sind(alpha),0;sind(alpha),cosd(alpha),0;0,0,1]
th2 = alpha;    th1 = beta-90;

a1 = n1(1,1);   b1 = n1(1,2);   c1 = n1(1,3);
a2 = n2(1,1);   b2 = n2(1,2);   c2 = n2(1,3);
n12 = [b1*c2-b2*c1, a2*c1-a1*c2, a1*b2-a2*b1];

th = 2 * acosd(cosd(th1/2)*cosd(th2/2)-sum(n1.*n2)*sind(th1/2)*sind(th2/2));
n = (n1*cosd(th2/2)*sind(th1/2)+n2*cosd(th1/2)*sind(th2/2)+
    n12*sind(th1/2)*sind(th2/2))/sind(th/2);
a1 = n(1,1);    b1 = n(1,2);    c1=n(1,3);

%求data2也就是旋转后的球面点坐标
data2 = [];
for i = 1:2226
    a2 = data(i,1);
    b2 = data(i,2);
    c2 = data(i,3);
    v = [a2 b2 c2];
    vv = [b1*c2-b2*c1, a2*c1-a1*c2, a1*b2-a2*b1];
    v1 = v*cosd(th) + vv*sind(th) + n*sum(n.*v)*(1-cosd(th));
    data2 = [data2; i, v1];
end
xlswrite("旋转球面.xls", data2);

%取出符合要求的点（然后才可以连线），存入到data3(是结构体数组)
cnt3 = 0;
for i = 1:2226
    name = names(i);
    x = data2(i,2);
    y = data2(i,3);
    z = data2(i,4);
    if(x^2+y^2<(150+0.3)^2)
        cnt3 = cnt3 + 1;
        data3(cnt3).x = x;
        data3(cnt3).y = y;
        data3(cnt3).z = z;
        data3(cnt3).num = i;
        data3(cnt3).name = name;
    end
end
cnt3
%根据选中的点们，选出a的大小
anss = inf;
finala = 0;
for a = 300.8:0.00001:301.0
    s = 0;
    p = a-300.4*0.534;
    for i = 1:cnt3
        num = data3(i).num;
        x2 = data3(i).x;
        y2 = data3(i).y;
        z2 = data3(i).z;
        ansx1 = (2*x2*(p*z2 + sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2); 
        ansy1 = ansx1 / x2 * y2;
        ansz1 = ansx1 / x2 * z2;
        ansx2 = (2*x2*(p*z2 - sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2);
        ansy2 = ansx2 / x2 * y2;
        ansz2 = ansx2 / x2 * z2;
        if ansz2 < ansz1
            ansx = ansx2;
            ansy = ansy2;
            ansz = ansz2;
        else
            ansx = ansx1;
            ansy = ansy1;
            ansz = ansz1;
        end
        if ansx^2 + ansy^2 <= 150^2
            tmps = sqrt((ansx - x2)^2 + (ansy - y2)^2 + (ansz - z2)^2);
            if tmps > 0.6
                tmps = 0.6;
            end
            s = s + tmps;
        end
    end
    if anss > s
        anss = s;
        finala = a;
    end
end
finala
%对于旋转后的球面，连接基准球面上的点和球心，取连线与抛物面的交点即为最终应该调整到的点
%并重新存入data4
a = finala;
p = a - R*0.534;
for i = 1:cnt3
    x2 = data3(i).x;
    y2 = data3(i).y;
    z2 = data3(i).z;
    ansx1 = (2*x2*(p*z2 + sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2); 
    ansy1 = ansx1 / x2 * y2;
    ansz1 = ansx1 / x2 * z2;
    ansx2 = (2*x2*(p*z2 - sqrt(p*(a*x2^2 + a*y2^2 + p*z2^2))))/(x2^2 + y2^2);
    ansy2 = ansx2 / x2 * y2;
    ansz2 = ansx2 / x2 * z2;
    if ansz2 < ansz1
        ansx = ansx2;
        ansy = ansy2;
        ansz = ansz2;
    else
        ansx = ansx1;
        ansy = ansy1;
        ansz = ansz1;
    end
    data4(i).x = ansx;
    data4(i).y = ansy;
    data4(i).z = ansz;
    data4(i).name = data3(i).name;
end
for i = 1 : cnt3
    x0 = data3(i).x;
    y0 = data3(i).y;
    z0 = data3(i).z;
    x1 = data4(i).x;
    y1 = data4(i).y;
    z1 = data4(i).z;
    
    data4(i).d = sqrt((x0-x1)^2+(y0-y1)^2+(z0-z1)^2);
    if data4(i).d > 0.6
        data4(i).d = 0.6;
    end
    if z1 > z0      %如果新节点更高的话就表示往上推了
        data4(i).d = data4(i).d;
    else            %否则表示往下拉了
        data4(i).d = -data4(i).d;
    end
    %将伸缩量数据存入表格
    ID = data4(i).name;
    delta = data4(i).d;
    ii = num2str(i);
    str1=strcat('A',ii);
    str1=[str1,':',str1];
    str2=strcat('B',ii);
    str2=[str2,':',str2];
    xlswrite('Output.xlsx',ID,1,str1);
    xlswrite('Output.xlsx',delta,1,str2);
    d = abs(data4(i).d);
    id = data3(i).num;
    x0 = data(id,1);
    y0 = data(id,2);
    z0 = data(id,3);
    data5(i).name = data3(i).name;
    data5(i).x = x0 - (d*x0)/sqrt(x0^2+y0^2+z0^2);
    data5(i).y = y0 - (d*y0)/sqrt(x0^2+y0^2+z0^2);
    data5(i).z = z0 - (d*z0)/sqrt(x0^2+y0^2+z0^2);
    %将坐标数据存入表格
    name = data5(i).name;
    xx = data5(i).x;
    yy = data5(i).y;
    zz = data5(i).z;
    ii = num2str(i);
    str1 = strcat('A',ii);
    str2 = strcat('B',ii);
    str3 = strcat('C',ii);
    str4 = strcat('D',ii);
    str1=[str1,':',str1];
    str2=[str2,':',str2];
    str3=[str3,':',str3];
    str4=[str4,':',str4];
    xlswrite('PointLocations2.xlsx',name,1,str1);
    xlswrite('PointLocations2.xlsx',xx,1,str2);
    xlswrite('PointLocations2.xlsx',yy,1,str3);
    xlswrite('PointLocations2.xlsx',zz,1,str4);
end

\end{lstlisting}
\section{第三问MATLAB代码一}
\begin{lstlisting}[language=matlab]
\end{lstlisting}
\section{第三问MATLAB代码二}
\end{appendices}
\end{document}